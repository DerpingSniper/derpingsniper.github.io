<!DOCTYPE html>
<HTML>
	<HEAD>
		<TITLE>Corbin Smith</TITLE>
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
		
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
        <!-- Custom Stylesheet -->
        <link rel = "stylesheet" href = "styles/styles.css">
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

        
        <script>
var canvas,
	FPS = 30,
    ctx,
    width = 600,
    height = 600,
    enemyTotal = 5,
    enemies = [],
    enemy_x = 50,
    enemy_y = -45,
    enemy_w = 50,
    enemy_h = 38,
    speed = 10,
    enemy,
    rightKey = false,
    leftKey = false,
    upKey = false,
    downKey = false,
    ship,
    ship_x = (width / 2) - 25, ship_y = height - 75, ship_w = 50, ship_h = 57,
	laser_x = (width / 2) - 25, laser_y = height - 75, laser_w = 7, laser_h = 19,
    laserTotal = 2,
    lasers = [],
	cloakTimer = 3000,
	cloak = false,
	cloakDur = 0,
    score = 0,
    alive = true,
    lives = 3,
    starfield,
    starX = 0, starY = 0, starY2 = -600,
    gameStarted = false;

//Array to hold all the enemies on screen
for (var i = 0; i < enemyTotal; i++) {
 enemies.push([enemy_x, enemy_y, enemy_w, enemy_h, speed]);
 enemy_x += enemy_w + 60;
}

//Clears the canvas so it can be updated
function clearCanvas() {
 ctx.clearRect(0,0,width,height);
}

//Cycles through the array and draws the updated enemy position
function drawEnemies() {
 for (var i = 0; i < enemies.length; i++) {
   ctx.drawImage(enemy, enemies[i][0], enemies[i][1]);
 }
}

//If an arrow key is being pressed, moves the ship in the right direction
function drawShip() {
 if (rightKey) ship_x += 5;
 else if (leftKey) ship_x -= 5;
 if (upKey) ship_y -= 5;
 else if (downKey) ship_y += 5;
 if (ship_x <= 0) ship_x = 0;
 if ((ship_x + ship_w) >= width) ship_x = width - ship_w;
  if (ship_y <= 0) ship_y = 0;
 if ((ship_y + ship_h) >= height) ship_y = height - ship_h;
  ctx.drawImage(ship, ship_x, ship_y);
}

//This moves the enemies downwards on the canvas and if one passes the bottom of the canvas, it moves it to above the canvas
function moveEnemies() {
  for (var i = 0; i < enemies.length; i++) {
   if (enemies[i][1] < height) {
     enemies[i][1] += enemies[i][4];
   } else if (enemies[i][1] > height - 1) {
      enemies[i][1] = -45;
    }
  }
}

//If there are lasers in the lasers array, then this will draw them on the canvas
function drawLaser() {
  if (lasers.length)
    for (var i = 0; i < lasers.length; i++) {
     ctx.drawImage(laser, lasers[i][0], lasers[i][1]);
   }
}

//If we're drawing lasers on the canvas, this moves them up the canvas
function moveLaser() {
 for (var i = 0; i < lasers.length; i++) {
   if (lasers[i][1] > -11) {
      lasers[i][1] -= 10;
    } else if (lasers[i][1] < -10) {
     lasers.splice(i, 1);
   }
 }
}

//Runs a couple of loops to see if any of the lasers have hit any of the enemies
function hitTest() {
 var remove = false;
 for (var i = 0; i < lasers.length; i++) {
   for (var j = 0; j < enemies.length; j++) {
     if (lasers[i][1] <= (enemies[j][1] + enemies[j][3]) && lasers[i][0] >= enemies[j][0] && lasers[i][0] <= (enemies[j][0] + enemies[j][2])) {
       remove = true;
        enemies.splice(j, 1);
		if(!cloak)
		{
        score += 10;
		cloakTimer += 300
		}
        enemies.push([(Math.random() * 500) + 50, -45, enemy_w, enemy_h, speed]);
      }
    }
    if (remove == true) {
      lasers.splice(i, 1);
      remove = false;
    }
  }
}

//Similar to the laser hit test, this function checks to see if the player's ship collides with any of the enemies
function shipCollision() {
  var ship_xw = ship_x + ship_w,
      ship_yh = ship_y + ship_h;
  for (var i = 0; i < enemies.length; i++) {
   if (ship_x > enemies[i][0] && ship_x < enemies[i][0] + enemy_w && ship_y > enemies[i][1] && ship_y < enemies[i][1] + enemy_h) {
    checkLives();
	cloakTimer = 3000;
    }
    if (ship_xw < enemies[i][0] + enemy_w && ship_xw > enemies[i][0] && ship_y > enemies[i][1] && ship_y < enemies[i][1] + enemy_h) {
    checkLives();
	cloakTimer = 3000;
    }
    if (ship_yh > enemies[i][1] && ship_yh < enemies[i][1] + enemy_h && ship_x > enemies[i][0] && ship_x < enemies[i][0] + enemy_w) {
    checkLives();
	cloakTimer = 3000;
    }
    if (ship_yh > enemies[i][1] && ship_yh < enemies[i][1] + enemy_h && ship_xw < enemies[i][0] + enemy_w && ship_xw > enemies[i][0]) {
    checkLives();
	cloakTimer = 3000;
    }
  }
}

//This function runs whenever the player's ship hits an enemy and either subtracts a life or sets the alive variable to false if the player runs out of lives
function checkLives() {
  lives -= 1;
  if (lives > 0) 
  {
    reset();
  } 
  else if (lives == 0) {
    alive = false;
	score = 0;
	cloakTimer = 3000;
  }
  else 
  {
	console.error("You screwed the game up. Start over.");
  }
}

//This simply resets the ship and enemies to their starting positions
function reset() {
  var enemy_reset_x = 50;
  ship_x = (width / 2) - 25, ship_y = height - 75, ship_w = 50, ship_h = 57;
  for (var i = 0; i < enemies.length; i++) {
   enemies[i][0] = enemy_reset_x;
   enemies[i][1] = -45;
   enemy_reset_x = enemy_reset_x + enemy_w + 60;
 }
}

//After the player loses all their lives, the continue button is shown and if clicked, it resets the game and removes the event listener for the continue button
function continueButton(e) {
 var cursorPos = getCursorPos(e);
 if (cursorPos.x > (width / 2) - 53 && cursorPos.x < (width / 2) + 47 && cursorPos.y > (height / 2) + 10 && cursorPos.y < (height / 2) + 50) {
   alive = true;
    lives = 3;
    reset();
    canvas.removeEventListener('click', continueButton, false);
  }
}

//holds the cursors position
function cursorPosition(x,y) {
  this.x = x;
  this.y = y;
}

//finds the cursor's position after the mouse is clicked
function getCursorPos(e) {
  var x;
  var y;
  if (e.pageX || e.pageY) {
    x = e.pageX;
    y = e.pageY;
  } else {
    x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
    y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
  }
  x -= canvas.offsetLeft;
  y -= canvas.offsetTop;
  var cursorPos = new cursorPosition(x, y);
  return cursorPos;
}

//Draws the text for the score and lives on the canvas and if the player runs out of lives, it's draws the game over text and continue button as well as adding the event listener for the continue button
function scoreTotal() {
  ctx.font = 'bold 20px VT323';
  ctx.fillStyle = '#fff';
  ctx.fillText('Score: ', 10, 55);
  ctx.fillText(score, 70, 55);
  ctx.fillText('Lives:', 10, 30);
  ctx.fillText(lives, 68, 30);
  ctx.fillText('Cloak:', 10, 80);
  ctx.fillText(Math.round(cloakTimer / 30) + "%", 68, 80);
        if (!gameStarted) {
    ctx.font = 'bold 50px VT323';
    ctx.fillText('Super PewPew', width / 2 - 190, height / 2);
    ctx.font = 'bold 20px VT323';
    ctx.fillText('How to Play', width / 2 - 56, height / 2 + 30);
    ctx.fillText('Use arrow keys to move', width / 2 - 100, height / 2 + 60);
    ctx.fillText('Use the x key to shoot', width / 2 - 100, height / 2 + 90);
	ctx.fillText('Use the c key to cloak', width / 2 - 100, height / 2 + 120);
	ctx.fillText('Click to start!', width / 2 - 100, height / 2 + 150);
  }
  if (!alive) 
 {
    ctx.fillText('Game Over!', 245, height / 2);
    ctx.fillRect((width / 2) - 60, (height / 2) + 10,100,40);
    ctx.fillStyle = '#000';
    ctx.fillText('Continue?', 250, (height / 2) + 35);
    canvas.addEventListener('click', continueButton, false);
  }
}

//Draws and animates the background starfield
function drawStarfield() {
  ctx.drawImage(starfield,starX,starY);
  ctx.drawImage(starfield,starX,starY2);
  if (starY > 600) {
    starY = -599;
  }
  if (starY2 > 600) {
    starY2 = -599;
  }
  starY += 1;
  starY2 += 1;
}

//The initial function called when the page first loads. Loads the ship, enemy and starfield images and adds the event listeners for the arrow keys. It then calls the gameLoop function.
function init() {
  canvas = document.getElementById('canvas');
  ctx = canvas.getContext('2d');
  enemy = new Image();
  enemy.src = 'http://www.weebly.com/uploads/3/2/1/8/32180299/enemy.png';
  ship = new Image();
  ship.src = 'http://www.weebly.com/uploads/3/2/1/8/32180299/ship.png';
  starfield = new Image();
  starfield.src = 'http://www.weebly.com/uploads/3/2/1/8/32180299/starfield.jpg';
  laser = new Image();
  laser.src = 'http://www.weebly.com/uploads/3/2/1/8/32180299/laser.png';
  document.addEventListener('keydown', keyDown, false);
  document.addEventListener('keyup', keyUp, false);
        canvas.addEventListener('click', gameStart, false);
  gameLoop();
}

function gameStart() {
  gameStarted = true;
  canvas.removeEventListener('click', gameStart, false);
}

//The main function of the game, it calls all the other functions needed to make the game run
function gameLoop() 
{
  clearCanvas();
  drawStarfield()
  if (alive && gameStarted && lives > 0) {
	hitTest();
    if(cloak == false)
	{
		shipCollision();
	}
    moveLaser();
    moveEnemies();
    drawEnemies();
    drawShip();
    drawLaser();
	cloakTimer = cloakTimer++;

	if(cloakTimer >= 0 && cloakTimer < 3000)
	{
		cloakTimer += 1;
	}
	else if(cloakTimer >= 3000)
	{
		cloakTimer = 3000;
	}
	
		if(cloak)
	{
		cloakDur -= 10;
		console.log("down");
	}
	else
	{
		cloakTimer = cloakTimer ++;
	}
			if(cloakDur > 0)
	{
		cloak = true;
		ship.src = 'http://www.weebly.com/uploads/3/2/1/8/32180299/shipcloak.png';
		cloakTimer = 0;
	}
	else
	{
		cloak = false;
		ship.src = 'http://www.weebly.com/uploads/3/2/1/8/32180299/ship.png';
	}
  }
  scoreTotal();
  game = setTimeout(gameLoop, 1000 / FPS);
}

//Checks to see which key has been pressed and either to move the ship or fire a laser
function keyDown(e) 
{
  if (e.keyCode == 39) rightKey = true;
  else if (e.keyCode == 37) leftKey = true;
  if (e.keyCode == 38) upKey = true;
  else if (e.keyCode == 40) downKey = true;
  if (e.keyCode == 88 && lasers.length <= laserTotal) lasers.push([ship_x + 22, ship_y - 20, 4, 20]);
  
  if (e.keyCode == 67 && cloakTimer >= 3000)
  {
	cloakDur = 660;
	cloakTimer = 0;
	cloak = true;
  }
}

//Checks to see if a pressed key has been released and stops the ships movement if it has
function keyUp(e) 
{
  if (e.keyCode == 39) rightKey = false;
  else if (e.keyCode == 37) leftKey = false;
  if (e.keyCode == 38) upKey = false;
  else if (e.keyCode == 40) downKey = false;
}

window.onload = init;
</script>

	</HEAD>
	
	<BODY>
		<div class = "navbar navbar-inverse navbar-fixed-top">
			<div class = "container">
			 
				<a href="#" class = "navbar-brand">Corbin Smith</a>
				
				<button class = "navbar-toggle" data-toggle = "collapse" data-target = ".navHeaderCollapse">
					<span class = "icon-bar"></span>
					<span class = "icon-bar"></span>
					<span class = "icon-bar"></span>
				</button>
				
				<div class = "collapse navbar-collapse navHeaderCollapse dropdown">
						<ul class = "nav navbar-nav navbar-right">
							<li><a href = "index.html">Home</a></li>
							<li><a href = "">About</a></li>
							<li class = "dropdown">
								<a href = "#" class = "dropdown-toggle" data-toggle = "dropdown">Check Me Out <b class = "caret"></b></a>
								<ul class = "dropdown-menu">
									<li><a href = "https://twitter.com/DerpingSniper">Twitter</a></li>
									<li><a href = "https://www.facebook.com/profile.php?id=100006653689083">Facebook</a></li>
									<li><a href = "https://github.com/DerpingSniper">GitHub</a></li>
								</ul>
							</li>
                            
                            <li class = "dropdown">
								<a href = "#" class = "dropdown-toggle" data-toggle = "dropdown">Projects <b class = "caret"></b></a>
								<ul class = "dropdown-menu">
									<li><a href = "pewpew2.html">Super PewPew</a></li>
                                    <li><a href = "primeSieve.html">Eratosthene's Sieve</a></li>
								</ul>
							</li>
 
                            <li><a href = "#contact" data-toggle="modal">Contact Me Now</a></li>
						</ul>
				</div>
			 
			</div>
		</div>
        
        <canvas id="canvas" width="600" height="600"></canvas>
  
	<audio autoplay loop>
		<source src="http://www.weebly.com/uploads/3/2/1/8/32180299/bgm.mp3" type="audio/mp3">
		Pew. Pew.
	</audio>

		<div class = "navbar navbar-default navbar-fixed-bottom">
			<div class = "container">
				<p class = "navbar-text pull-left">Site built by Corbin Smith</p>
				
				<a href = "https://www.youtube.com/channel/UCy5LtPZba7qIWmE-EwW1rbQ" class = "navbar-btn btn btn-danger pull-right">Subscribe</a>
			</div>
		</div>
        
        <div class = "modal fade" id = "contact" role = "dialog">
            <div class = "modal-dialog">
                <div class = "modal-content">
                    <form class = "form-horizontal" action = "process.php">
                        
                        <div class = "modal-header">
                            <h4>Contact Me</h4>
                        </div>
                    
                        <div class = "modal-body">
                            
                            <div class = "form-group">
                                <label for = "contact-name" class = "col-lg-2 control-label">Name:</label>
                                <div class = "col-lg-10">
                                    <input type = "text" class = "form-control" id = "contact-name" placeholder = "Full Name">
                                </div>
                            </div>
                            
                            <div class = "form-group">
                                <label for = "contact-email" class = "col-lg-2 control-label">Email:</label>
                                <div class = "col-lg-10">
                                    <input type = "email" class = "form-control" id = "contact-email" placeholder = "Your Email">
                                </div>
                            </div>
                            
                            <div class = "form-group">
                                <label for = "contact-message" class = "col-lg-2 control-label">Message:</label>
                                <div class = "col-lg-10">
                                   <textarea class = "form-control" rows = 8></textarea>
                                </div>
                            </div>
                        
                        </div>
                    
                        <div class = "modal-footer">
                            <a class = "btn btn-default" data-dismiss = "modal">Close</a>
                            <button class = "btn btn-primary" type = "submit">Send</button>
                        </div>
                    </form>
                
                </div>
            </div>
        </div>

	</BODY>
</HTML>